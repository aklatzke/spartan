function ibs_util_19(){return"AIzaSyBwcmfwl7W1aMyo9wnXwmASRfZ0sOhGhRc"}function IsEmail(a){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(a)}function CalendarObj(a,e,h){this.init(e,h)}
(function(a){CalendarObj.prototype.init=function(e,h){var d=this;this.args=e;this.mode=h;this.id=e.id;this.calendar=a("#fullcalendar-"+this.id);this.options={id:"1",feeds:{},ajaxUrl:null,ajaxData:null};for(var k in e)"undefined"!==typeof this.options[k]&&(this.options[k]=e[k]);this.qtip_params=function(c){var b=d.fullcalendar_options.timeFormat,a="";"undefined"!==typeof c.location&&""!==c.location&&(a="<p>Location: "+c.location+"</p>");var f="";"undefined"!==typeof c.description&&""!==c.description&&
(f="<p>"+c.description+"</p>");b=moment(c.start).format("ddd MMM DD "+b)+moment(c.end).format(" - "+b);c.allDay&&(b=moment(c.start).format("ddd MMM DD")+"  All day");return{content:{text:"<p>"+c.title+"</p>"+a+f+"<p>"+b+"</p>"},position:{my:"bottom center",at:"top center"},style:{classes:e.qtip.style+" "+e.qtip.rounded+e.qtip.shadow},show:{event:"mouseover"},hide:{fixed:!0,delay:250,event:"mouseout mouseleave"}}};this.fullcalendar_options={timezone:"local",height:null,theme:!0,firstDay:"1",weekends:!0,
lang:"en_us",timeFormat:"hh:mm a",titleFormat:"YYYY MMM DD",dayNamesShort:"Sun Mon Tue Wed Thu Fri Sat".split(" "),defaultView:"month",eventLimit:6,eventLimitClick:"popover",aspectRatio:1,editable:!1,hiddenDays:"",fixedWeekCount:!0,weekNumbers:!1,defaultDate:moment()};for(k in e)"undefined"!==typeof this.fullcalendar_options[k]&&""!==e[k]&&(this.fullcalendar_options[k]=e[k]);this.fullcalendar_options.header={left:e.headerLeft,center:e.headerCenter,right:e.headerRight};this.fullcalendar_options.loading=
function(c){if(c&&"widget"!==h){c=a("#fullcalendar-"+d.options.id).position();var b=a("#fullcalendar-"+d.options.id).width(),e=a("#fullcalendar-"+d.options.id).height();a("#ibs-loading-"+d.options.id).css({left:c.left,top:c.top,width:b,height:e}).show()}else a("#ibs-loading-"+d.options.id).hide()};this.fullcalendar_options.eventRender=function(a,b,q){("widget"===h||e.hideTitle)&&b.css("color",b.css("background-color"));b.css("cursor","pointer");"admin"===h&&"month"!==q.name||b.qtip(d.qtip_params(a))};
this.fullcalendar_options.eventClick=function(a,b,d){if(a.url)return window.open(a.url),!1};this.fullcalendar_options.dayClick=function(a,b,d){};this.fullcalendar_options.eventAfterAllRender=function(c){if("none"!==e.event_list&&a("#list-display-"+d.id).is(":checked")){c="#event-table-"+d.id;var b=a("#fullcalendar-"+d.id).fullCalendar("clientEvents");b.sort(function(a,b){return moment(a.start)-moment(b.start)});var q=[];if(!1===e.list_past||!1===e.list_repeat){for(var f=0;f<b.length;f++)if("string"!==
typeof b[f].repeat||null===b[f].repeat||""===b[f].repeat||!1!==e.list_repeat)!1===e.list_past&&moment()>moment(b[f].start)||q.push(b[f]);b=q}b=b.slice(0,e.list_max);a(c).empty();if("widget"!==h)for(a(c).css({border:"1px solid silver"}).append(a("<tbody>").append(a("<tr>").addClass("ui-widget-header").append(a("<th>").text("Day").css("padding","3px")).append(a("<th>").text("Time").css("padding","3px")).append(a("<th>").text("Event").css("padding","3px")).append(a("<th>").text("Location").css("padding",
"3px")))),f=0;f<b.length;f++){var q=moment()>moment(b[f].start)?"*":"",u=moment(b[f].start).format("ddd Do"),k=moment(b[f].start).format(d.fullcalendar_options.timeFormat);a(c).find("tbody").append(a("<tr>").attr({disabled:q}).append(a("<td>").text(u).css("padding","3px")).append(a("<td>").text(k).css("padding","3px")).append(a("<td>").append(a("<a>").attr({href:b[f].url,target:"_blank"}).html(q+b[f].title))).append(a("<td>").text(b[f].location).css("padding","3px")))}else for(a(c).css({border:"1px solid silver"}).append(a("<tbody>").append(a("<tr>").addClass("ui-widget-header").append(a("<th>").text("Events").css("padding",
"3px")))),f=0;f<b.length;f++)q=moment()>moment(b[f].start)?"*":"",a(c).find("tbody").append(a("<tr>").qtip(d.qtip_params(b[f])).append(a("<td>").append(a("<a>").attr({href:b[f].url,target:"_blank"}).html(q+b[f].title))))}};this.renderCalendar=function(){"none"===e.event_list?a("#list-display-"+d.id).parent().css("display","none"):a("#list-display-"+d.id).prop("checked","show"===e.event_list);e.legend&&a("#legend-list-"+d.id).css("display","block");this.calendar.fullCalendar(this.fullcalendar_options);
for(var c in this.options.feeds)if(""!==this.options.feeds[c].url&&this.options.feeds[c].enabled){var b={googleCalendarApiKey:function(){return"string"===typeof d.options.feeds[c].key&&""!==d.options.feeds[c].key?d.options.feeds[c].key:ibs_util_19()},feedName:this.options.feeds[c].name,textColor:this.options.feeds[c].textColor,backgroundColor:this.options.feeds[c].backgroundColor,url:this.options.feeds[c].url,googleCalendarId:IsEmail(this.options.feeds[c].url)?this.options.feeds[c].url:null};this.calendar.fullCalendar("addEventSource",
b);a("#legend-list-"+d.id).append(a("<span>").addClass("ibs-legend-color").css({"background-color":this.options.feeds[c].backgroundColor})).append(a("<span>").addClass("ibs-legend-name").text(this.options.feeds[c].name))}e.ibsEvents&&this.calendar.fullCalendar("addEventSource",{events:function(a,b,c,e){c=[];for(var k in d.ibs_events){var g=d.ibs_events[k];if(0==g.recurr){var l,m,h,r;l=a.unix();m=b.unix();h=moment(g.start).unix();r=moment(g.end).unix();(h>=l&&r<=m||r>l&&r<m||h>=l&&h<=m||l>=h&&m<=r)&&
c.push(g)}else{l=[];if(g.exceptions){l=g.exceptions.split(",");for(var n in l)l[n]=moment(l[n]).startOf("day")}m=(new RRule(RRule.parseString(g.repeat))).between(a.toDate(),b.toDate());for(n in m)m[n]=moment(m[n]).startOf("day");h=moment(g.end).diff(moment(g.start),"seconds");r=moment(g.start).unix()-moment(g.start).startOf("day").unix();for(n in m){var p;a:{p=n;var t=void 0;for(t in l)if(0===l[t].diff(m[p])){p=!0;break a}p=!1}p||(p=m[n].startOf("day"),p={start:p.add(r,"seconds").format(),end:p.add(h,
"seconds").format(),id:g.id,title:g.title,allDay:g.allDay,color:g.color,textColor:g.textColor,description:g.description,url:g.url,repeat:g.repeat,exceptions:g.exceptions},c.push(p))}}for(n in c)c[n].textColor="#ffffff",c[n].editable=!1}e(c)}});"none"!==e.event_list&&("show"===e.event_list&&a("#event-list-"+d.id).show(),a("#list-display-"+d.id).click(function(b){a("#list-display-"+d.id).is(":checked")?(a("#fullcalendar-"+d.id).fullCalendar("rerenderEvents"),a("#event-list-"+d.id).show()):a("#event-list-"+
d.id).hide()}))};e.ibsEvents?a.get(d.options.ajaxUrl,{action:"ibs_calendar_get_events",cache:!1,dataType:"json"}).then(function(a){if(""!==a){a=decodeURIComponent(a);d.ibs_events=JSON.parse(a);for(var b in d.ibs_events)d.ibs_events[b].title=jQuery("<div>").html(d.ibs_events[b].title).text(),d.ibs_events[b].description=jQuery("<div>").html(d.ibs_events[b].description).text(),d.ibs_events[b].editable=!1,d.ibs_events[b].start=moment.unix(parseInt(d.ibs_events[b].start)).format(),d.ibs_events[b].end=
moment.unix(parseInt(d.ibs_events[b].end)).format();console.log("IBS Events loaded.")}else d.ibs_events=[];d.renderCalendar()},function(){console.log("Get IBS Events failed.")}):d.renderCalendar()}})(jQuery);
